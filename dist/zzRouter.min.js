let zzRouter={};import{utils}from"./utils.js";zzRouter.utils=utils;import{defaultOptions}from"./defaultOptions.js";zzRouter.defaultOptions=defaultOptions;import{htmlFetcher}from"./htmlFetcher.js";zzRouter.htmlFetcher=htmlFetcher;import{version}from"./version.js";zzRouter.version=version,zzRouter.start=function(t){if(this.options={},this.utils.extend(this.options,this.defaultOptions,t),this.checkOptions(),this.options.preloadPagesOnStart){let t=this;void this.htmlFetcher.loadAllUrls(this,()=>{t.init()})}else this.init()},zzRouter.init=function(){this.routesMap=this.createRoutesMap(),this.stack=[],this.addEventListenersForWindow(),this.navigateUrl(this.options.updateOnStart?window.location.href:"",this.options.animateTransitionsOnStart)},zzRouter.checkOptions=function(){let t=0,e="";this.options.routes||(++t,e+="routes must be defined. "),this.options.eventsByPage||(++t,e+="eventsByPage must be defined. "),t&&this.alertError("Unable to initalize zzRouter. "+t+" errors found: "+e)},zzRouter.alertError=function(t){throw alert(t),t},zzRouter.addEventListenersForWindow=function(){window.onpopstate=t=>{this.navigateUrl(window.location.href,!0)}},zzRouter.addEventListenersForLinks=function(t){let n=this;this.utils.addEventListenerOnList(document.getElementById(t).getElementsByTagName("a"),"click",t=>{var e=t.target.getAttribute("href");e.startsWith(n.options.PAGE_PREFIX)&&(t.preventDefault(),history.pushState({page:e},"page "+e,"#"+e),n.navigateUrl(e,!0))})},zzRouter.createRoutesMap=function(){let e={};return(this.options.routes||[]).map(t=>{e[t.id]=t}),e},zzRouter.getRouteItem=function(t){var e=this.routesMap[t];return e||this.routesMap[this.options.PAGE_ID_404_ERROR]||{id:this.options.PAGE_ID_404_ERROR,content:"<h3>404 - Page not found: "+t+"</h3>"}},zzRouter.navigateUrl=function(t,n){let i=this.utils.analizeUrl(t,this.options),s=this.updateStack(i.page);if(s!=i.page){t=this.getContentForPage(i.page);let e=this;t instanceof Promise?t.then(function(t){e.getRouteItem(i.page).content=t,e.doPageTransition(t,i.page,s,i,n)}):this.doPageTransition(t,i.page,s,i,n)}},zzRouter.updateStack=function(t){var e;return this.stack[this.stack.length-2]==t?this.stack.pop():(e=this.stack[this.stack.length-1],this.stack.push(t),e)},zzRouter.getContentForPage=function(t){t=this.getRouteItem(t);return this.getContentForRoute(t)},zzRouter.getContentForRoute=function(t){if(t.keepAlive){var e=document.getElementById(t.id);if(e)return e}var e=t.content;return e||((e=t.url)?this.htmlFetcher.loadUrl(e):'<div id="error">No content found for route from path '+t.id+"</div>")},zzRouter.doPageTransition=function(t,e,n,i,s){var o=s&&!!this.options.animationOut;let r=s&&!!this.options.animationIn,a=t instanceof HTMLElement?this.defaultOptions.EVENT_REINIT:this.defaultOptions.EVENT_INIT,u=(this.runEvent(this.defaultOptions.EVENT_BEFORE_OUT,n,{}),document.getElementsByClassName("currentPage")[0]),l=this.addNextPage(u,t,e),d=(this.runRenderRelated(a,e,i),this),h=()=>{u.removeEventListener("animationend",h),l.classList.remove("hidden"),r&&l.classList.add(this.options.animationIn),this.retireCurrentPage(n,u),d.runEvent(this.defaultOptions.EVENT_AFTER_OUT,n,{}),r||E()},E=()=>{l.removeEventListener("animationend",E),l.classList.remove("nextPage"),l.classList.add("currentPage"),r&&l.classList.remove(this.options.animationIn),d.runEvent(a,e,i),d.runEvent(this.defaultOptions.EVENT_MOUNTED,e,i)};o&&u.addEventListener("animationend",h),r&&l.addEventListener("animationend",E),o?u.classList.add(this.options.animationOut):h()},zzRouter.runRenderRelated=function(t,e,n){var i=t===this.options.EVENT_INIT?this.options.EVENT_PRE_INIT:this.options.EVENT_PRE_REINIT,i=(this.runEvent(i,e,n),this.getRouteItem(e)),n=t===this.options.EVENT_INIT?this.options.RUN_RENDER_BEFORE_EVENT_INIT:this.options.RUN_RENDER_BEFORE_EVENT_REINIT,t=t===this.options.EVENT_INIT?"runRenderBeforeInit":"runRenderBeforeReinit";(void 0===i[t]?n:i[t])&&this.options.renderFunction&&this.utils.isFunction(this.options.renderFunction)&&this.options.renderFunction(this.buildPageInstance(e))},zzRouter.buildPageInstance=function(t){return{id:t,el:document.getElementById(t)}},zzRouter.addNextPage=function(t,e,n){return e instanceof HTMLElement?(t.insertAdjacentElement("afterend",e),e.classList.add("nextPage"),e.classList.add("hidden"),e.classList.remove("alive")):t.insertAdjacentHTML("afterend",'<div class="nextPage hidden page" id="'+n+'">'+e+"</div>"),document.getElementById(n)},zzRouter.retireCurrentPage=function(t,e){t=this.getRouteItem(t);t&&t.keepAlive?(e.removeAttribute("class"),e.classList.add("page"),e.classList.add("alive")):e.remove()};let defaultOptions={updateOnStart:!0,preloadPagesOnStart:!(zzRouter.runEvent=function(t,e,n){t==this.defaultOptions.EVENT_INIT&&this.addEventListenersForLinks(e);e=this.options.eventsByPage[e];e&&(n={params:n.params||{}},e[t])&&this.utils.isFunction(e[t])&&e[t](n)}),animationOut:"slide-out-top",animationIn:"scale-in-center",animateTransitionsOnStart:!1,PAGE_PREFIX:"!",PAGE_ID_HOME:"[home]",PAGE_ID_404_ERROR:"[404]",EVENT_PRE_INIT:"preInit",EVENT_INIT:"init",EVENT_PRE_REINIT:"preReinit",EVENT_REINIT:"reinit",EVENT_MOUNTED:"mounted",EVENT_BEFORE_OUT:"beforeOut",EVENT_AFTER_OUT:"afterOut",RUN_RENDER_BEFORE_EVENT_INIT:!0,RUN_RENDER_BEFORE_EVENT_REINIT:!1};import{utils}from"./utils.js";let htmlFetcher={loadAllUrls:function(t,n){t=t.options.routes||[];let i=0;t.map(e=>{var t=e.url;t&&(++i,htmlFetcher.loadUrl(t).then(function(t){e.content=t,0==--i&&n&&utils.isFunction(n)&&n()}))})},loadUrl:async function(t){var e=await fetch(t);if(e.ok)return await e.text();throw t=`Error fetching ${t} has occured: `+e.status,alert(t),new Error(t)}},utils={analizeUrl:function(t,e){var n={},t=t.split(e.PAGE_PREFIX),t=(n.prepage=t[0],t[1]||""),t=(n.prepage.endsWith("#")&&(n.prepage=n.prepage.slice(0,-1)),t.split("?")),e=(n.page=t[0],""==n.page&&(n.page=e.PAGE_ID_HOME),t[1]||"");if(n.params={},""!=e){var i=e.split("&");for(let t=0;t<i.length;t++){var s=i[t].split("="),o=s[0];n.params[o]=s[1]}}return n},addEventListenerOnList:function(n,i,s){for(let t=0,e=n.length;t<e;t++)n[t].addEventListener(i,s,!1)},extend:function(t,e,n){t=t||{};for(var i=1;i<arguments.length;i++)if(arguments[i])for(var s in arguments[i])arguments[i].hasOwnProperty(s)&&(t[s]=arguments[i][s]);return t},isFunction:function(t){return"function"==typeof t&&"number"!=typeof t.nodeType}},version="0.1.0";export{zzRouter,defaultOptions,htmlFetcher,utils,version};