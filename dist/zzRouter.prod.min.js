var h={};h.analizeUrl=function(t,e){let n={},i=t.split(e.PAGE_PREFIX);n.prepage=i[0];let s=i[1]||"";n.prepage.endsWith("#")&&(n.prepage=n.prepage.slice(0,-1));let a=s.split("?");n.page=a[0],n.page==""&&(n.page=e.PAGE_ID_HOME);let o=a[1]||"";if(n.params={},o=="")return n;let E=o.split("&");for(let l=0;l<E.length;l++){let u=E[l].split("="),d=u[0],p=u[1];n.params[d]=p}return n};h.addEventListenerOnList=function(t,e,n){for(let i=0,s=t.length;i<s;i++)t[i].addEventListener(e,n,!1)};h.extend=function(t,e,n){t=t||{};for(var i=1;i<arguments.length;i++)if(arguments[i])for(var s in arguments[i])arguments[i].hasOwnProperty(s)&&(t[s]=arguments[i][s]);return t};h.isFunction=function(e){return typeof e=="function"&&typeof e.nodeType!="number"};var m={updateOnStart:!0,preloadPagesOnStart:!1,animationOut:"slide-out-top",animationIn:"scale-in-center",animateTransitionsOnStart:!1,PAGE_PREFIX:"!",PAGE_ID_HOME:"[home]",PAGE_ID_404_ERROR:"[404]",EVENT_PRE_INIT:"preInit",EVENT_INIT:"init",EVENT_PRE_REINIT:"preReinit",EVENT_REINIT:"reinit",EVENT_MOUNTED:"mounted",EVENT_BEFORE_OUT:"beforeOut",EVENT_AFTER_OUT:"afterOut",RUN_RENDER_BEFORE_EVENT_INIT:!0,RUN_RENDER_BEFORE_EVENT_REINIT:!1};var f={};f.loadAllUrls=function(t,e){let n=t.options.routes||[],i=0;n.map(s=>{let a=s.url;a&&(++i,f.loadUrl(a).then(function(o){s.content=o,--i==0&&e&&h.isFunction(e)&&e()}))})};f.loadUrl=async function(t){let e=await fetch(t);if(!e.ok){let i=`Error fetching ${t} has occured: ${e.status}`;throw alert(i),new Error(i)}return await e.text()};var g="0.1.0";var r={};r.utils=h;r.defaultOptions=m;r.htmlFetcher=f;r.version=g;r.start=function(t){if(this.options={},this.utils.extend(this.options,this.defaultOptions,t),this.checkOptions(),this.options.preloadPagesOnStart){let e=this;this.htmlFetcher.loadAllUrls(this,()=>{e.init()});return}this.init()};r.init=function(){this.routesMap=this.createRoutesMap(),this.stack=[],this.addEventListenersForWindow(),this.navigateUrl(this.options.updateOnStart?window.location.href:"",this.options.animateTransitionsOnStart)};r.checkOptions=function(){let t=0,e="";this.options.routes||(++t,e+="routes must be defined. "),this.options.eventsByPage||(++t,e+="eventsByPage must be defined. "),t&&this.alertError("Unable to initalize zzRouter. "+t+" errors found: "+e)};r.alertError=function(t){throw alert(t),t};r.addEventListenersForWindow=function(){window.onpopstate=t=>{this.navigateUrl(window.location.href,!0)}};r.addEventListenersForLinks=function(t){let e=this;this.utils.addEventListenerOnList(document.getElementById(t).getElementsByTagName("a"),"click",n=>{let i=n.target.getAttribute("href");i.startsWith(e.options.PAGE_PREFIX)&&(n.preventDefault(),history.pushState({page:i},"page "+i,"#"+i),e.navigateUrl(i,!0))})};r.createRoutesMap=function(){let t={};return(this.options.routes||[]).map(n=>{t[n.id]=n}),t};r.getRouteItem=function(t){let e=this.routesMap[t];return e||(e=this.routesMap[this.options.PAGE_ID_404_ERROR],e)?e:{id:this.options.PAGE_ID_404_ERROR,content:"<h3>404 - Page not found: "+t+"</h3>"}};r.navigateUrl=function(t,e){let n=this.utils.analizeUrl(t,this.options),i=this.updateStack(n.page);if(i==n.page)return;let s=this.getContentForPage(n.page),a=this;if(s instanceof Promise){s.then(function(o){let E=a.getRouteItem(n.page);E.content=o,a.doPageTransition(o,n.page,i,n,e)});return}this.doPageTransition(s,n.page,i,n,e)};r.updateStack=function(t){if(this.stack[this.stack.length-2]==t)return this.stack.pop();var n=this.stack[this.stack.length-1];return this.stack.push(t),n};r.getContentForPage=function(t){let e=this.getRouteItem(t);return this.getContentForRoute(e)};r.getContentForRoute=function(t){if(t.keepAlive){let i=document.getElementById(t.id);if(i)return i}let e=t.content;if(e)return e;let n=t.url;return n?this.htmlFetcher.loadUrl(n):'<div id="error">No content found for route from path '+t.id+"</div>"};r.doPageTransition=function(t,e,n,i,s){let a=s&&!!this.options.animationOut,o=s&&!!this.options.animationIn,E=t instanceof HTMLElement?this.defaultOptions.EVENT_REINIT:this.defaultOptions.EVENT_INIT;this.runEvent(this.defaultOptions.EVENT_BEFORE_OUT,n,{});let l=document.getElementsByClassName("currentPage")[0],u=this.addNextPage(l,t,e);this.runRenderRelated(E,e,i);let d=this,p=()=>{l.removeEventListener("animationend",p),u.classList.remove("hidden"),o&&u.classList.add(this.options.animationIn),this.retireCurrentPage(n,l),d.runEvent(this.defaultOptions.EVENT_AFTER_OUT,n,{}),o||c()},c=()=>{u.removeEventListener("animationend",c),u.classList.remove("nextPage"),u.classList.add("currentPage"),o&&u.classList.remove(this.options.animationIn),d.runEvent(E,e,i),d.runEvent(this.defaultOptions.EVENT_MOUNTED,e,i)};a&&l.addEventListener("animationend",p),o&&u.addEventListener("animationend",c),a?l.classList.add(this.options.animationOut):p()};r.runRenderRelated=function(t,e,n){let i=t===this.options.EVENT_INIT?this.options.EVENT_PRE_INIT:this.options.EVENT_PRE_REINIT;this.runEvent(i,e,n);let s=this.getRouteItem(e),a=t===this.options.EVENT_INIT?this.options.RUN_RENDER_BEFORE_EVENT_INIT:this.options.RUN_RENDER_BEFORE_EVENT_REINIT,o=t===this.options.EVENT_INIT?"runRenderBeforeInit":"runRenderBeforeReinit";(s[o]===void 0?a:s[o])&&this.options.renderFunction&&this.utils.isFunction(this.options.renderFunction)&&this.options.renderFunction(this.buildPageInstance(e))};r.buildPageInstance=function(t){return{id:t,el:document.getElementById(t)}};r.addNextPage=function(t,e,n){return e instanceof HTMLElement?(t.insertAdjacentElement("afterend",e),e.classList.add("nextPage"),e.classList.add("hidden"),e.classList.remove("alive")):t.insertAdjacentHTML("afterend",'<div class="nextPage hidden page" id="'+n+'">'+e+"</div>"),document.getElementById(n)};r.retireCurrentPage=function(t,e){let n=this.getRouteItem(t);if(n&&n.keepAlive){e.removeAttribute("class"),e.classList.add("page"),e.classList.add("alive");return}e.remove()};r.runEvent=function(t,e,n){t==this.defaultOptions.EVENT_INIT&&this.addEventListenersForLinks(e);let i=this.options.eventsByPage[e];if(i){let s={params:n.params||{}};i[t]&&this.utils.isFunction(i[t])&&i[t](s)}};export{r as zzRouter};
